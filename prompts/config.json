{
  "description": "Prompt configuration for HipKittens/Triton kernel generation",
  
  "default_prompt": "hipkittens_base.txt",
  "triton_default_prompt": "triton_high_performance.txt",
  "triton_correctness_prompt": "triton_high_correctness.txt",
  "triton_performance_prompt": "triton_high_performance.txt",
  
  "patterns": {
    "matmul|matrix_mult|gemm|mm_|square.*matrix|standard.*matrix": "hipkittens_gemm.txt",
    "tall.*skinny|skinny|irregular|large_k|small_k": "hipkittens_gemm.txt",
    "bmm|batched.*matrix|3d.*matrix|4d.*matrix": "hipkittens_base.txt",
    "mv_|matvec|matrix_vector": "hipkittens_gemm.txt",
    "linear|fc|dense|mlp": "hipkittens_gemm.txt",
    "gemm.*add|add.*relu|gemm.*relu|gemm.*bias|bias.*relu": "hipkittens_gemm.txt",
    "relu|sigmoid|tanh|gelu|selu|elu|softplus|softsign|leaky|hard|silu|swish": "elementwise_bf16.txt",
    "softmax|logsoftmax": "elementwise_bf16.txt",
    "layernorm|batchnorm|groupnorm|instancenorm|rmsnorm": "elementwise_bf16.txt",
    "norm_|frobenius|l1norm|l2norm": "elementwise_bf16.txt",
    "pool|max_|mean_|sum_|argmax|argmin|min_": "elementwise_bf16.txt"
  },
  
  "triton_patterns": {
    "matmul|matrix_mult|gemm|mm_|square.*matrix|standard.*matrix": "triton_gemm_mi350_golden.txt",
    "tall.*skinny|skinny|irregular|large_k|small_k": "triton_gemm_mi350_golden.txt",
    "bmm|batched.*matrix|3d.*matrix|4d.*matrix": "triton_gemm_mi350_golden.txt",
    "mv_|matvec|matrix_vector": "triton_gemm_mi350_golden.txt",
    "linear|fc|dense|mlp": "triton_gemm_mi350_golden.txt",
    "transposed": "triton_gemm_mi350_golden.txt",
    
    "relu|sigmoid|tanh|gelu|selu|elu|softplus|softsign|leaky|hard|silu|swish|mish|newgelu": "triton_elementwise_optimized.txt",
    "softmax|logsoftmax": "triton_softmax.txt",
    "layernorm|batchnorm|groupnorm|instancenorm|rmsnorm": "triton_norm.txt",
    "norm_|frobenius|l1norm|l2norm": "triton_norm.txt",
    "pool|pooling|maxpool|avgpool": "triton_pooling.txt",
    "sum_|mean_|max_|min_|argmax|argmin|reduction": "triton_reduction.txt",
    "scalar": "triton_elementwise_optimized.txt"
  },
  
  "triton_level2_patterns": {
    "gemm.*add|add.*relu|gemm.*relu|gemm.*bias|bias.*relu": "triton_gemm_mi350_golden.txt",
    "scaling|residual|add|divide|multiply|subtract": "triton_gemm_mi350_golden.txt"
  },

  "reflection_hints": {
    "PERFORMANCE TOO SLOW": [
      "Check adaptive block size: 256x256 for min(M,N)>=512, else 128x128",
      "Use shared memory with swizzled offsets and double buffering",
      "Use __builtin_amdgcn_s_setprio(1/0) around mma operations"
    ],
    "Compile error": [
      "cpp_src must ONLY have declarations, NO PYBIND11_MODULE",
      "Use extern __shared__ with shared_allocator, NOT static __shared__",
      "Use hipFuncSetAttribute((void*)kernel, ...) for dynamic shared memory"
    ],
    "accuracy.*fail|max diff": [
      "CRITICAL: Use s_waitcnt vmcnt(0) after G::load",
      "CRITICAL: Use s_waitcnt lgkmcnt(0) after shared->register load",
      "Use subtile_inplace to extract per-warp data from shared tiles"
    ]
  },
  
  "triton_reflection_hints": {
    "PERFORMANCE TOO SLOW (<0.5x)": [
      "CRITICAL: Add XCD swizzle for MI350's 32 XCDs - without it you get ~0.3-0.5x!",
      "Use: pids_per_xcd = (num_pids + 31) // 32; xcd_id = pid % 32; local_pid = pid // 32",
      "Then: remapped_pid = xcd_id * pids_per_xcd + local_pid"
    ],
    "accuracy.*fail|max diff|NaN": [
      "Use float32 accumulator for all computation",
      "Convert back to input dtype at store: y.to(tl.float16)",
      "Check if input is float16 or bfloat16 and match output dtype"
    ]
  }
}
